# SBOM Comparison Tools

This repository contains two command-line tools for comparing Software Bill of Materials (SBOM) files generated by [Syft](https://github.com/anchore/syft).

## Tools Overview

### 1. `sbom-diff.sh` - Docker Image SBOM Comparison
A comprehensive tool that generates SBOMs for two Docker images and compares their package manifests.

### 2. `sbom-analyze.sh` - Advanced SBOM Analysis
A detailed analysis tool for comparing existing SBOM files with advanced reporting capabilities.

## Prerequisites

Both tools require the following dependencies:

- **jq** - JSON processor for parsing SBOM files
  ```bash
  # macOS
  brew install jq
  
  # Ubuntu/Debian
  sudo apt-get install jq
  ```

- **syft** - SBOM generation tool (only required for `sbom-diff.sh`)
  ```bash
  # macOS
  brew install syft
  
  # Linux
  curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin
  ```

## Usage

### sbom-diff.sh

Generate and compare SBOMs for two Docker images:

```bash
./sbom-diff.sh <image1> <image2> [options]
```

**Options:**
- `-h, --help`: Show help message
- `-o, --output DIR`: Output directory for SBOM files (default: ./sbom-output)
- `-v, --verbose`: Verbose output
- `-k, --keep-files`: Keep intermediate SBOM files after comparison

**Examples:**
```bash
# Basic comparison
./sbom-diff.sh ubuntu:20.04 ubuntu:22.04

# With custom output directory and verbose output
./sbom-diff.sh nginx:latest nginx:alpine -o /tmp/sbom-results -v

# Keep intermediate files for further analysis
./sbom-diff.sh java:11 java:17 -k
```

**Output:**
- Package counts for each image
- Common packages between images
- Packages unique to each image
- Detailed comparison report saved to file

### sbom-analyze.sh

Analyze and compare existing SBOM files:

```bash
./sbom-analyze.sh <sbom1.json> <sbom2.json> [options]
```

**Options:**
- `-h, --help`: Show help message
- `-o, --output DIR`: Output directory for analysis results (default: ./analysis-output)
- `-d, --detailed`: Show detailed package information including versions
- `-f, --format FORMAT`: Output format: text, json, csv (default: text)
- `-t, --type TYPE`: Analysis type: packages, vulnerabilities, all (default: packages)

**Examples:**
```bash
# Basic analysis
./sbom-analyze.sh image1-sbom.json image2-sbom.json

# Detailed analysis with JSON output
./sbom-analyze.sh image1-sbom.json image2-sbom.json --detailed --format json

# Generate CSV reports
./sbom-analyze.sh image1-sbom.json image2-sbom.json --detailed --format csv
```

**Output Formats:**
- **Text**: Human-readable report with summaries and lists
- **JSON**: Structured data for programmatic processing
- **CSV**: Separate CSV files for different analysis categories

## Example Workflow

1. **Generate SBOMs and compare images:**
   ```bash
   ./sbom-diff.sh ubuntu:20.04 ubuntu:22.04 -k -o ./comparison-results
   ```

2. **Perform detailed analysis on generated SBOMs:**
   ```bash
   ./sbom-analyze.sh ./comparison-results/ubuntu-20.04_sbom.json ./comparison-results/ubuntu-22.04_sbom.json -d -f json
   ```

## Sample Output

### sbom-diff.sh output:
```
✓ SBOM generated successfully: ./sbom-output/ubuntu-20.04_sbom.json
✓ SBOM generated successfully: ./sbom-output/ubuntu-22.04_sbom.json

=== SBOM Comparison Results ===

Image 1: ubuntu:20.04
  Total packages: 127

Image 2: ubuntu:22.04
  Total packages: 142

Common packages: 98
Packages only in ubuntu:20.04: 29
Packages only in ubuntu:22.04: 44

Packages only in ubuntu:20.04:
  - pkg:deb/ubuntu/libssl1.1@1.1.1f-1ubuntu2.20
  - pkg:deb/ubuntu/python3.8@3.8.10-0ubuntu1~20.04.8
  ...

Packages only in ubuntu:22.04:
  + pkg:deb/ubuntu/libssl3@3.0.2-0ubuntu1.10
  + pkg:deb/ubuntu/python3.10@3.10.12-1~22.04.2
  ...
```

### sbom-analyze.sh output:
```
=== QUICK SUMMARY ===
SBOM 1: ubuntu-20.04_sbom.json
  Total packages: 127
SBOM 2: ubuntu-22.04_sbom.json
  Total packages: 142

=== DETAILED ANALYSIS ===
Generated: 2025-01-03 15:30:45

=== SUMMARY ===
Packages in SBOM 1: 127
Packages in SBOM 2: 142
Common packages: 98
Packages only in SBOM 1: 29
Packages only in SBOM 2: 44
Version differences: 15
```

## Understanding the Output

### Package Comparison
- **Common packages**: Packages present in both images with identical versions
- **Packages only in Image 1**: Packages present in the first image but not in the second
- **Packages only in Image 2**: Packages present in the second image but not in the first
- **Version differences**: Packages present in both images but with different versions

### Use Cases
- **Security compliance**: Compare base images to identify security updates
- **Dependency analysis**: Understand what changes between image versions
- **Optimization**: Identify unnecessary packages in container images
- **Audit trails**: Document package differences for compliance purposes

## Notes

- The tools sort packages alphabetically to ensure consistent comparisons
- Package URLs are used as unique identifiers for comparison
- The `manifests` section of the SBOM contains the resolved package dependencies
- Both tools are compatible with zsh and bash shells
- Generated files are saved with sanitized filenames (special characters replaced with hyphens)

## Example Files

The repository includes example SBOM files that demonstrate the expected format:
- `sbom/java-21.0--github-sbom.json`
- `cookbook/add-bash/add-bash--github-sbom.json`

These files show the structure of syft-generated SBOMs in GitHub JSON format.
